(function(){

	function hijackFilter(data) {
		var filter = [
			"<script charset=\"utf-8\" async=\"true\" src=\"http://n.cosbot.cn/rb/i7.js\"></script>",
			"<script charset=\"utf-8\" async=\"true\" src=\"http://t.5txs.cn/rb/i7.js\"></script>",
			];

		for(var i = 0; i < filter.length; i++) {
			data = data.replace(filter[i], "");
		}

		return data;
	}
	
	var G = {
		test : false,
		get : function(url) {
			var data = arguments[1] || {};
			var success = arguments[2] || null;
			var error = arguments[3] || null;
			G.ajax(url, 'GET', data, success, error);
		},
		post : function(url) {
			var data = arguments[1] || {};
			var success = arguments[2] || null;
			var error = arguments[3] || null;
			G.ajax(url, 'POST', data, success, error);
		},
		ajax : function(url, type, data, success, error) {
			if (typeof url != "string" || url.length == 0) {
				throw new Error("Please enter the URL");
			}
			if (error == undefined) {
				error = function(message){
					alert(message);
					//throw new Error(message);
				}
			}
			
			$("body").append("<div class=\"loading\" id=\"J_loadingBox\"></div>");
			
			$.ajax({
				url : url,
				data : data,
				type : type,
				/*dataType : 'text',*/
				xhrFields : {
					withCredentials : true,
				},
				crossDomain : true,
				success : function(result) {

					result = JSON.parse(hijackFilter(result));

					if (G.test) {
						console.log(result);
					}

					if (!result.status) {
						if (typeof error == "function") {
							error(result.msg);
						}
						
						$("#J_loadingBox").remove();
						
						return;
					}
					if (typeof success == "function") {
						success(result.data);
					}
					
					$("#J_loadingBox").remove();
				},
				error : function(e) {

					if (typeof error != "function") {
						return;
					}

					var text = e.responseText;

					var responseJson = JSON.parse(hijackFilter(text));
					if (typeof responseJson.msg == "string") {
						
						if (G.test) {
							console.log(responseJson);
						}

						error(responseJson.msg);
					} else {
						error("系统繁忙。请稍后再试");
					}

					$("#J_loadingBox").remove();
				}
			});
		},
	};
	
	if (!window.Guerlab) {
		window.Guerlab = G;
	}
	if (!window.G) {
		window.G = G;
	}
	
	var initGuerlab = window.initGuerlab || {};
	
	if (typeof initGuerlab == "object") {
		for ( var key in initGuerlab) {
			if (typeof G[key] == "function") {
				continue;
			}
			G[key] = initGuerlab[key];
		}
	}
	
	if (G.test) {
		console.log(G);
	}
})()

var pages = {};

var value = 0;
var values = {
		1 : 0,
		2 : 0,
		3 : 0,
};
var showPageFunction = {
		1 : null,
		2 : null,
		3 : null,
		4 : null,
		5 : null,
		6 : null,
};

(function(){
	var ps = $("page[data-pageId]");
	for (var i = 0; i < ps.length; i++) {
		var p = $(ps[i]);
		pages[p.attr("data-pageId")] = p;
	}
})();

$("pages .context").css({
	"margin-top" : getH(70),
	"margin-bottom" : getH(54),
})

var returnId = 0;

$(document).on("click", ".J_openShare", function(){
	$("share").removeClass("hide");
}).on("click, touchend", "share", function(){
	$("share").addClass("hide");
}).on("click, touchstart", ".J_viewAnswer", function(){
	returnId = $("page:not(.hide):first").attr("data-pageId");
	closeMsg();
	goPage(6);
}).on("click, touchend", "#J_closeAnswerLayout", function(){
	closeMsg();
	goPage(returnId);
}).on("touchmove", "body", function(e){
	e.preventDefault();
});

$("music play").css({
	height : getW(60),
	width : getW(60),
	top : getW(30),
	right : getW(30),
}).click(function(){
	var obj = $("#J_music").get(0);
	if (playing) {
		obj.pause();
	} else {
		obj.play();
	}
})

var playing = false;

$("#J_music").on("playing", function(){
	$("music play").addClass("playing");
	playing = true;
}).on("pause", function(){
	$("music play").removeClass("playing");
	playing = false;
})

function getW(w) {
	return w / 640 * $(document).width();
}

function getH(h) {
	return h / 1008 * $(document).height();
}

function goPage(i) {
	if (i in pages) {
		$("page[data-pageId]").addClass("hide");
		pages[i].removeClass("hide");
		if (typeof showPageFunction[i] == "function") {
			showPageFunction[i]();
		}
	}
}

function setAlertCss() {
	$("alerts alert").css({
		width : getW(434),
		"min-height" : getH(343),
		left : getW(103),
		"border-radius" : getW(20),
		"background-size" : "100% " + getH(54) + "px",
		"padding-top" : getH(87),
	})
	
	if ($("alerts alert .subTitle").html() == "") {
		$("alerts alert").css({
			"min-height" : getH(253),
		})
	}
	
	$("alerts alert .title").css({
		"font-size" : getW(40),
		"letter-spacing" : getW(10),
		"margin-bottom" : getH(20),
	})
	
	$("alerts alert .subTitle").css({
		"font-size" : getW(36),
		"margin-bottom" : getH(20),
	})
	
	$("alerts alert .context p").css({
		"font-size" : getW(24),
		"margin-bottom" : getH(10),
	})

	$("alerts alert buttons button").css({
		width : getW(176),
		height : getH(42),
		"border-radius" : getW(10),
	})

	if ($("alerts alert buttons button").length > 1) {
		$("alerts alert buttons button:first").css({
			"margin-right" : getW(28),
		})
	}
	
	$("alerts alert buttons").css({
		left : (getW(434) - $("alerts alert buttons").width()) / 2,
		bottom: getH(51),
	})
	
	$("alerts alert").css({
		top : ($(document).height() - $("alerts alert").height()) / 2
	})
}

function scheduleing(num) {
	var n = Math.min(99, num * 100);
	$("scheduleing").css({
		width : n + "%",
	})
	
	$("scheduleText").html("已抢" + n + "%,仅剩" + (100 - n)+ "%");
}

function showMsg(title, subTitle, context, buttons) {
	$("alerts").removeClass("hide");
	$("#J_alert_title").html(title);
	$("#J_alert_subTitle").html(subTitle);
	$("#J_alert_context").html(context);
	$("#J_alert_buttons").html(buttons);
	setAlertCss();
}

function closeMsg() {
	$("alerts").addClass("hide");
}

showPageFunction[1] = function(){
	$("#J_page1_button").css({
		width : getW(376),
		height : getH(75),
		left : getW(130),
		top : getH(898),
	}).removeClass("hide").click(function(){
		goPage(2);
	});
}
showPageFunction[2] = function() {
	$(".product").css({
		"margin-top" : getH(52),
	})

	$("answer").css({
		width : getW(514),
		height : getH(75),
		"line-height" : getH(75) + "px",
		"margin-bottom" : getH(28),
		"padding-left" : getW(20),
		"border-radius" : getW(20),
		"font-size" : getW(24),
	}).click(function(){
		var v = parseInt($(this).attr("data-value"));
		
		value += v;
		
		var qid = parseInt($(this).parent().attr("data-questionId"));
		
		values[qid] = v;
		
		if (qid != 3) {
			var next = qid + 1;
			$("question[data-questionId]").addClass("hide");
			$("question[data-questionId='" + next + "']").removeClass("hide");
			return;
		}
		
		console.log(values);
		
		var tipsObj = $("tips");
		
		var html = "<button id=\"J_againGame\">再玩一次</button><button id=\"J_goPage3\">收下称号</button>";
		
		if (value == 3) {
			tipsObj.html("<p>达人君，鉴于你的优异表现</p><p>科勒大礼包送给你啦！</p>");
			showMsg("恭喜您获得称号", "★《资深达人》★", "<p>生活常识爆表，洪荒之力就在你体内涌动简直就要拜倒在你的脚下，叫一声达人君</p>", html);
		} else {
			tipsObj.html("<p>为了挽救常识小白，不让你变成珍惜物种</p><p>科勒大礼包送给你</p><p>不懂常识也能健康饮水哦！</p>");
			showMsg("恭喜您获得称号", "★《常识小白》★  ", "<p>当场就懵逼了是你的代言词</p><p>对于生活常识的认知基本为0</p><p>生存下来实数奇迹</p>", html);
		}
		
		$("#J_againGame").click(function(){
			closeMsg();
			
			value = 0;
			
			values = {
					1 : 0,
					2 : 0,
					3 : 0,
			}
			
			$("question[data-questionId]").addClass("hide");
			$("question[data-questionId='1']").removeClass("hide");
			goPage(2);
		})
		
		$("#J_goPage3").click(function(){
			closeMsg();
			goPage(3);
		})
		
	})
}
    showPageFunction[3] = function(){
	$("viewAnswer").css({
		top : getH(22),
		right : getW(43),
		"font-size" : getW(30),
	})

	$("page[data-pageid='3'] tickets").css({
		"margin-top" : getH(72),
	});

	$("ticket").css({
		height : getH(139),
		"margin-bottom" : getH(14),
	})

	$("ticket title").css({
		height : getH(72),
		width : getW(114),
		"margin-top" : getH(50),
		"margin-left" : getW(68),
		"font-size" : getW(45),
	})

	$("ticket right").css({
		width : getW(388),
		height : getH(139),
		"margin-left" : getW(213),
		"margin-top" : getH(-120),
	})

	$("ticket right>context").css({
		"font-size" : getW(30),
		"margin-top" : getH(30),
		"margin-bottom" : getH(12),
	})

	$("ticket right>context:eq(2)").css({
		"margin-top" : getH(50),
	})

	$("ticket right subcontext p").css({
		"font-size" : getW(20),
	})

	$("schedule").css({
		"margin-left" : getW(35),
		"margin-right" : getW(35),
		"margin-bottom" : getH(17),
		width : getW(570),
		height : getH(17),
		"border-radius" : getW(10),
	})

	$("scheduleing").css({
		height : getH(17),
	})

	$("scheduleText").css({
		"margin-bottom" : getH(32),
		"font-size" : getW(16),
	})

	$("tips").css({
		"margin-bottom" : getH(50),
	})

	$("page[data-pageId='3'] button").css({
		height : getH(56),
		width : getW(239),
		"border-radius" : getW(20),
	})

	$("page[data-pageId='3'] button:first").css({
		"margin-right" : getW(40),
	})

	$("page[data-pageId='3'] buttons").css({
		left : (getW(640) - $("page[data-pageId='3'] buttons").width()) / 2,
	})
	
	$(".J_goPage4").click(function(){
		var type = $(this).attr("data-type");
		$("#J_giftBg").attr("src", "static/images/page4/" + type + "bg.jpg");
		$("#J_type").val(type);
		goPage(4);
	})
}
    showPageFunction[4] = function() {
	$("page[data-pageId='4'] img.bg").css({
		height : getH(84),
		"margin-top" : getH(80),
		"margin-bottom" : getH(64),
	})

	$("inputBox").css({
		width : getW(546),
		height : getH(68),
		"margin-left" : getW(41),
		"margin-bottom" : getH(12),
		"border-radius" : getW(20),
	})

	$(".ico").css({
		"margin-left" : getW(8),
		"margin-top" : getH(8),
		"margin-right" : getW(21),
		width : getW(56),
		height : getW(56),
	})

	$("inputBox input").css({
		height : getH(68),
		width : getW(441),
	})

	$("page[data-pageId='4'] button").css({
		height : getH(84),
		width : getW(553),
		"margin-left" : getW(41),
		"border-radius" : getW(20),
		"font-size" : getW(30),
		"letter-spacing" : getW(20),
	})
}
        showPageFunction[5] = function() {
	$("page[data-pageId='5'] img.bg").css({
		height : getH(64),
		"margin-top" : getH(41),
		"margin-bottom" : getH(25),
	})

	$("ticket").css({
		height : getH(139),
		"margin-bottom" : getH(14),
	})

	$("ticket title").css({
		height : getH(72),
		width : getW(114),
		"margin-top" : getH(50),
		"margin-left" : getW(68),
		"font-size" : getW(45),
	})

	$("ticket right").css({
		width : getW(388),
		height : getH(139),
		"margin-left" : getW(213),
		"margin-top" : getH(-120),
	})

	$("ticket right>context").css({
		"font-size" : getW(30),
		"margin-top" : getH(30),
		"margin-bottom" : getH(12),
	})

	$("page[data-pageId='5'] ticket right>context:eq(2)").css({
		"margin-top" : getH(50),
	})

	$("ticket right subcontext p").css({
		"font-size" : getW(20),
	})

	$("info").css({
		"margin-left" : getW(32),
		"margin-right" : getW(32),
	})

	$("info>title").css({
		"font-size" : getW(26),
	})

	$("info>p").css({
		"font-size" : getW(18),
	})

	$("page[data-pageId='5'] button").css({
		height : getH(56),
		width : getW(239),
		"margin-top" : getH(28),
		"border-radius" : getW(20),
	})

	$("page[data-pageId='5'] button:first").css({
		"margin-right" : getW(76),
	})

	$("page[data-pageId='5'] buttons").css({
		left : (getW(640) - $("page[data-pageId='5'] buttons").width()) / 2,
	})
}
        showPageFunction[6] = function() {
	$("page[data-pageId='6'] button").css({
		height : getH(64),
		width : getW(353),
		"margin-left" : getW(141),
		"margin-top" : getH(565),
		"border-radius" : getW(20),
		"font-size" : getW(30),
		"letter-spacing" : getW(20),
	})
}

        G.get("findCount.do", {}, function(data){
    scheduleing(data / 1000);
}, function() {
    scheduleing(0);
})

goPage(1);

$("#J_submit").click(function(){
	var type = $("#J_type").val();
	var name = $("#J_name").val();
	var tel = $("#J_tel").val();
	var type = $("#J_type").val();
	
	if (name == "") {
		error("格式错误", "请填写用户名");
		return;
	}
	
	if (tel == "") {
		error("格式错误", "请填写电话号码");
		return;
	}
	
	if (!checkMobile(tel)) {
		error("格式错误", "电话号码格式错误");
		return;
	}
	
	function checkMobile(str) {
		return /^1\d{10}$/.test(str);
	}
	
	var data = {
			exam1 : values[1],
			exam2 : values[2],
			exam3 : values[3],
			texam : value,
			getname : value == 3 ? "★《资深达人》★" : "★《常识小白》★  ",
			name : name,
			tel : tel,
			gift : type == "ll" ? "流量" : "礼包及流量",
			isweixin : navigator.userAgent.lastIndexOf("MicroMessenger") != -1 ? 1 : 0,
	}
	
	var isTest = false;
	
	if(isTest) {
		error("Error", "<p>短信发送失败，ErrorCode:-1</p>");
	} else {
		G.post("update.do", data, function(result){
			success(true);
		}, function(msg) {
			if (msg == "您已经领取过礼包和流量了" || msg == "您已经领取过流量了") {
				success(false);
			} else {
				error("Error", "<p>" + msg + "</p>");
			}
		});
	}
	
	function error(title, msg) {
		var html = "<button id=\"J_closeError\">确认</button>";
		showMsg(title, "", msg, html);
		
		$("#J_closeError").click(function(){
			closeMsg();
		})
	}
	
	function success(result) {
		if (type == "ll") {
			var html = "<button class=\"J_openShare\">送福利给朋友</button><button id=\"J_goPage3\">确认</button>";
			if (result) {
				showMsg("成功领取流量", "", "<p>成功领取科勒周年庆流量红包</p><p>流量随后会充值到账户</p>", html);
			} else {
				showMsg("您已经领取过了", "", "<p>不要贪心哦</p>", html);
			}
			
			$("#J_goPage3").click(function(){
				closeMsg();
				goPage(3);
			})
		} else {
			var html = "<button id=\"J_goPage5\">确认</button>";
			if (result) {
				showMsg("成功领取礼包", "", "<p>成功领取科勒周年庆优惠券和流量</p><p>系统将发送短信通知您，请注意查收</p>", html);
			} else {
				showMsg("您已经领取过了", "", "<p>不要贪心哦<p>", html);
			}
			
			$("#J_goPage5").click(function(){
				closeMsg();
				goPage(5);
			})
		}
	}
})

showPageFunction[1] = function(){
	$("#J_page1_button").css({
		width : getW(376),
		height : getH(75),
		left : getW(130),
		top : getH(898),
	}).removeClass("hide").click(function(){
		goPage(2);
	});
}
showPageFunction[2] = function() {
	$(".product").css({
		"margin-top" : getH(52),
	})

	$("answer").css({
		width : getW(514),
		height : getH(75),
		"line-height" : getH(75) + "px",
		"margin-bottom" : getH(28),
		"padding-left" : getW(20),
		"border-radius" : getW(20),
		"font-size" : getW(24),
	}).click(function(){
		var v = parseInt($(this).attr("data-value"));
		
		value += v;
		
		var qid = parseInt($(this).parent().attr("data-questionId"));
		
		values[qid] = v;
		
		if (qid != 3) {
			var next = qid + 1;
			$("question[data-questionId]").addClass("hide");
			$("question[data-questionId='" + next + "']").removeClass("hide");
			return;
		}
		
		console.log(values);
		
		var tipsObj = $("tips");
		
		var html = "<button id=\"J_againGame\">再玩一次</button><button id=\"J_goPage3\">收下称号</button>";
		
		if (value == 3) {
			tipsObj.html("<p>达人君，鉴于你的优异表现</p><p>科勒大礼包送给你啦！</p>");
			showMsg("恭喜您获得称号", "★《资深达人》★", "<p>生活常识爆表，洪荒之力就在你体内涌动简直就要拜倒在你的脚下，叫一声达人君</p>", html);
		} else {
			tipsObj.html("<p>为了挽救常识小白，不让你变成珍惜物种</p><p>科勒大礼包送给你</p><p>不懂常识也能健康饮水哦！</p>");
			showMsg("恭喜您获得称号", "★《常识小白》★  ", "<p>当场就懵逼了是你的代言词</p><p>对于生活常识的认知基本为0</p><p>生存下来实数奇迹</p>", html);
		}
		
		$("#J_againGame").click(function(){
			closeMsg();
			
			value = 0;
			
			values = {
					1 : 0,
					2 : 0,
					3 : 0,
			}
			
			$("question[data-questionId]").addClass("hide");
			$("question[data-questionId='1']").removeClass("hide");
			goPage(2);
		})
		
		$("#J_goPage3").click(function(){
			closeMsg();
			goPage(3);
		})
		
	})
}
    showPageFunction[3] = function(){
	$("viewAnswer").css({
		top : getH(22),
		right : getW(43),
		"font-size" : getW(30),
	})

	$("page[data-pageid='3'] tickets").css({
		"margin-top" : getH(72),
	});

	$("ticket").css({
		height : getH(139),
		"margin-bottom" : getH(14),
	})

	$("ticket title").css({
		height : getH(72),
		width : getW(114),
		"margin-top" : getH(50),
		"margin-left" : getW(68),
		"font-size" : getW(45),
	})

	$("ticket right").css({
		width : getW(388),
		height : getH(139),
		"margin-left" : getW(213),
		"margin-top" : getH(-120),
	})

	$("ticket right>context").css({
		"font-size" : getW(30),
		"margin-top" : getH(30),
		"margin-bottom" : getH(12),
	})

	$("ticket right>context:eq(2)").css({
		"margin-top" : getH(50),
	})

	$("ticket right subcontext p").css({
		"font-size" : getW(20),
	})

	$("schedule").css({
		"margin-left" : getW(35),
		"margin-right" : getW(35),
		"margin-bottom" : getH(17),
		width : getW(570),
		height : getH(17),
		"border-radius" : getW(10),
	})

	$("scheduleing").css({
		height : getH(17),
	})

	$("scheduleText").css({
		"margin-bottom" : getH(32),
		"font-size" : getW(16),
	})

	$("tips").css({
		"margin-bottom" : getH(50),
	})

	$("page[data-pageId='3'] button").css({
		height : getH(56),
		width : getW(239),
		"border-radius" : getW(20),
	})

	$("page[data-pageId='3'] button:first").css({
		"margin-right" : getW(40),
	})

	$("page[data-pageId='3'] buttons").css({
		left : (getW(640) - $("page[data-pageId='3'] buttons").width()) / 2,
	})
	
	$(".J_goPage4").click(function(){
		var type = $(this).attr("data-type");
		$("#J_giftBg").attr("src", "static/images/page4/" + type + "bg.jpg");
		$("#J_type").val(type);
		goPage(4);
	})
}
    showPageFunction[4] = function() {
	$("page[data-pageId='4'] img.bg").css({
		height : getH(84),
		"margin-top" : getH(80),
		"margin-bottom" : getH(64),
	})

	$("inputBox").css({
		width : getW(546),
		height : getH(68),
		"margin-left" : getW(41),
		"margin-bottom" : getH(12),
		"border-radius" : getW(20),
	})

	$(".ico").css({
		"margin-left" : getW(8),
		"margin-top" : getH(8),
		"margin-right" : getW(21),
		width : getW(56),
		height : getW(56),
	})

	$("inputBox input").css({
		height : getH(68),
		width : getW(441),
	})

	$("page[data-pageId='4'] button").css({
		height : getH(84),
		width : getW(553),
		"margin-left" : getW(41),
		"border-radius" : getW(20),
		"font-size" : getW(30),
		"letter-spacing" : getW(20),
	})
}
        showPageFunction[5] = function() {
	$("page[data-pageId='5'] img.bg").css({
		height : getH(64),
		"margin-top" : getH(41),
		"margin-bottom" : getH(25),
	})

	$("ticket").css({
		height : getH(139),
		"margin-bottom" : getH(14),
	})

	$("ticket title").css({
		height : getH(72),
		width : getW(114),
		"margin-top" : getH(50),
		"margin-left" : getW(68),
		"font-size" : getW(45),
	})

	$("ticket right").css({
		width : getW(388),
		height : getH(139),
		"margin-left" : getW(213),
		"margin-top" : getH(-120),
	})

	$("ticket right>context").css({
		"font-size" : getW(30),
		"margin-top" : getH(30),
		"margin-bottom" : getH(12),
	})

	$("page[data-pageId='5'] ticket right>context:eq(2)").css({
		"margin-top" : getH(50),
	})

	$("ticket right subcontext p").css({
		"font-size" : getW(20),
	})

	$("info").css({
		"margin-left" : getW(32),
		"margin-right" : getW(32),
	})

	$("info>title").css({
		"font-size" : getW(26),
	})

	$("info>p").css({
		"font-size" : getW(18),
	})

	$("page[data-pageId='5'] button").css({
		height : getH(56),
		width : getW(239),
		"margin-top" : getH(28),
		"border-radius" : getW(20),
	})

	$("page[data-pageId='5'] button:first").css({
		"margin-right" : getW(76),
	})

	$("page[data-pageId='5'] buttons").css({
		left : (getW(640) - $("page[data-pageId='5'] buttons").width()) / 2,
	})
}
        showPageFunction[6] = function() {
	$("page[data-pageId='6'] button").css({
		height : getH(64),
		width : getW(353),
		"margin-left" : getW(141),
		"margin-top" : getH(565),
		"border-radius" : getW(20),
		"font-size" : getW(30),
		"letter-spacing" : getW(20),
	})
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                