<!DOCTYPE html>
<html>
<head lang="en">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="yes" name="apple-touch-fullscreen">
<meta content="telephone=no,email=no" name="format-detection">
<meta content="fullscreen=yes,preventMove=no" name="ML-Config">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>摇摇星冰乐</title>
<link rel="stylesheet" href="css/all.css" />
<link rel="stylesheet" href="css/indexone.css" />
<link rel="stylesheet" href="css/leading.css" />
<script type="text/javascript" src="//static.guerlab.net/jquery/jquery-2.X.X.min.js"></script>
<script type="text/javascript" src="js/findlist.js"></script>
</head>
<body>
	<div class="loading" id="J_loading">
		<div class="logo"></div>
	</div>
	<div id="J_main" class=" hide">
		<!--主页面-->
		<div class="main">
 			<!--活动尚未开始-->
            <div class="noplay hide" id="J_noplay">
                    <!--未开始确定按钮-->
                <div class="nobut">
                   <img src="img/nobut.png" alt="确定按钮"/>
                </div>
            </div>
			<!--杯子-->
			<div class="bei bei_bg_0"></div>
			<!--查看奖励-->
			<div class="but">
				<img src="img/chakan.png" id="findlist"/>
			</div>
			<!--瑶瑶规则-->
			<div class="gui" style="display: block">
				<div class="guibut">
					<img class="guibutimg" src="img/guibut.png" alt="" />
				</div>
			</div>
			<!--奖品列表-->
			<div class="goods_jiang" id="goods_jiang">
				<div class="goods_box">
					<div class="G_t got01">
						<img src="img/G01.png" alt="">
						<div class="G_tnum J_goods" data-goods-id="1">00</div>
					</div>
					<div class="G_t got02">
						<img src="img/G02.png" alt="">
						<div class="G_tnum J_goods" data-goods-id="2">00</div>
					</div>
					<div class="G_t got03">
						<img src="img/G03.png" alt="">
						<div class="G_tnum J_goods" data-goods-id="3">00</div>
					</div>
					<div class="G_t got04">
						<img src="img/G04.png" alt="">
						<div class="G_tnum J_goods" data-goods-id="4">00</div>
					</div>
					<div class="G_t got05">
						<img src="img/G05.png" alt="">
						<div class="G_tnum J_goods" data-goods-id="5">00</div>
					</div>
					<div class="G_t got06">
						<img src="img/G06.png" alt="">
						<div class="G_tnum J_goods" data-goods-id="6">00</div>
					</div>
				</div>
				<div class="goods_but">
					<img src="img/G_but.png" alt="">
				</div>
			</div>
			<!--中奖弹出页面-->
			<div class="goods">
				<!--商品信息-->
				<div class="all goods01">
					<!--关闭商品-->
					<div class="allCl close_goods1"></div>
				</div>
				<!--商品信息-->
				<div class="all goods02">
					<!--关闭商品-->
					<div class="allCl close_goods2"></div>
				</div>
				<div class="all goods03">
					<div class="allCl close_goods3"></div>
				</div>
				<div class="all goods04">
					<div class="allCl close_goods4"></div>
				</div>
				<div class="all goods05">
					<div class="allCl close_goods5"></div>
				</div>
				<div class="all goods06">
					<div class="allCl close_goods6"></div>
				</div>
				<div class="all goods07">
					<div class="allCl close_goods7"></div>
				</div>
				<div class="all goods08">
					<div class="allCl close_goods8"></div>
				</div>
				<div class="all goods09">
					<div class="allCl close_goods9"></div>
				</div>
				<div class="all goods10">
					<div class="allCl close_goods10"></div>
				</div>
				<div class="all goods11">
					<div class="allCl close_goods11"></div>
				</div>
				<div class="all goods12">
					<div class="allCl close_goods12"></div>
				</div>
			</div>
		</div>
	</div>
</body>
<script src="//static.guerlab.net/tongji/tongji.min.js"></script>
<script src="js/tasks.js"></script>
<script src="js/loading.min.js"></script>
<script>
	tongji.put("starbucks20160322");
</script>
<script type="text/javascript">
	function begin() {
	}
	function page_begin() {
	}
	//    重力感应事件
	if (window.DeviceMotionEvent) {
		window.addEventListener('devicemotion', deviceMotionHandler, false);
	}
	var canSend = true;
	var runWobble = false;
	var speed = 30;//speed
	var x = y = z = lastX = lastY = lastZ = 0;
	function deviceMotionHandler(eventData) {
		var acceleration = eventData.accelerationIncludingGravity;
		x = acceleration.x;
		y = acceleration.y;
		z = acceleration.z;
		if (Math.abs(x - lastX) > speed || Math.abs(y - lastY) > speed || Math.abs(z - lastZ) > speed) {
			run();
		}
		lastX = x;
		lastY = y;
		lastZ = z;
	}

	function run() {
		if (!canSend) {
			return;
		}
		
		donghua();
			
		//简单的摇一摇触发代码
		//            动画开始
		var disP = $(".gui").css('display');
		var disP1 = $(".goods").css('display');
		var disP2 = $(".goods_jiang").css('display');
		if (disP == 'block' || disP1 == 'block' || disP2 == 'block') {
			return;
		} else {
			canSend = false;
			sendData();
		}
	}
		
	function sendData() {
		$.ajax({
			url : "isBegin.do",
			type : "POST",
			dataType : "json",
			success : function(result){
				if (!result.data) {
					$("#J_noplay").removeClass("hide");
					return;
				}
				$.ajax({
					url : "updateUser.do",
					type : "POST",
					dataType:"json",
					success : function(data) {
						tongji.put("starbucks20160322", "run");
							
						if (!data.status) {
							alert(data.msg);
							canSend = true;
							return;
						} else {
							var id = data.data.gtype;

							setTimeout(function() {
								$(".goods").css({display : "block"});
								$(".all").eq(id - 1).css({display : "block"}).siblings().css({display : "none"});
							}, 1500);
						}
					}
				})
			}
		})
	}
		
	var nowBei = 0;

	//    动画事件添加
	function donghua() {
		if (runWobble) {
			return;
		}
			
		var beiObj = $(".bei");
			
		runWobble = true;
		beiObj.addClass('wobble');
			
		setTimeout(function(){
			beiObj.removeClass("bei_bg_0");
			beiObj.removeClass("bei_bg_1");
			beiObj.removeClass("bei_bg_2");
				
			beiObj.addClass("bei_bg_" + (++nowBei % 3));
				
			setTimeout(function(){
				runWobble = false;
				beiObj.removeClass('wobble');
			}, 1000);
		}, 1000);
	}
	
	$(".guibut").click(function() {
		$(".gui").css({display : "none"})
	});
	
	$(".allCl").click(function() {
		canSend = true;
		$(".goods").css({display : "none"});
	});
	
	//        列表点击关闭
	$(".goods_but").click(function() {
		$(".goods_jiang").css({display : "none"})
	});
	
	//        点击查看我的奖品
	$(".but").click(functio